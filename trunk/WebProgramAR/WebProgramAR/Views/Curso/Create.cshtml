@model PMI.CETools.Sitio.Models.TouchPointCreateOrEditModel


@{
    ViewBag.Title = PMI.CETools.Recursos.AppResources.Vistas.Nuevo;
}

<h2>@PMI.CETools.Recursos.AppResources.Vistas.Nuevo</h2>

<link href="@Url.Content("~/Content/common.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/ui.multiselect.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/utils.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Scripts/jquery.cascade.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.cascade.ext.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.templating.js")" type="text/javascript"></script>


<style>
	.ui-autocomplete {
		max-height: 100px;
		overflow-y: auto;
		/* prevent horizontal scrollbar */
		overflow-x: hidden;
		/* add padding to account for vertical scrollbar */
		padding-right: 20px;
	}
</style>


<script type="text/javascript">
    $("#btnCancelar").click(function (event) {
        CerrarDialog();
    });

</script>

<script type="text/javascript">

    $("#btnAceptar").click(function (event) {
        
        $('#FileName').val($('#file').val());
        
        $(".error").remove();
        event.preventDefault();

        var form = $("form");
        $.ajax({
            type: 'POST',
            dataType: 'json',
            //contentType: "application/json; charset=utf-8",
            data: form.serialize(),
            url: '@Url.Action("ValidarDescripcion")',
            success: function (data) {
                tratarError(data);
            },
                error: function (jqXhr, textStatus, errorThrown) {
                    alert("Error '" + jqXhr.status + "' (textStatus: '" + textStatus + "', errorThrown: '" + errorThrown + "')");
                }
            })
        });


    function tratarError(result) {
        //alert(result);
        if (result != null) {
            $(".error").remove();
            DisplayErrors(result);
        }
        else {
            //alert('Submit al cerrar');
            $('form').submit();
            //alert('After Submit');
        }


    }



    function Error(response, status, error) {
        debugger;
        alert("Oops! " + response.statusText + " " + error.D);
    }
</script>

@using (Html.BeginForm("Create", "TouchPoint", FormMethod.Post, new { enctype = "multipart/form-data" }))
{ 
   @Html.ValidationSummary(true)
    <fieldset>
        <legend>@PMI.CETools.Recursos.AppResources.Vistas.TouchPoint</legend>

        @Html.HiddenFor(model => model.TouchPoint.Mode)

        <br style="height:5px" />
        @Html.Partial("_CreateOrEdit", Model)
        @*@Html.Partial("_CreateOrEditObj", Model)*@

        <br style="height:5px" />
        <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
                <td align="center">
                    <input type="submit" value="@PMI.CETools.Recursos.AppResources.Vistas.Guardar" class="boton" id="btnAceptar"/>
                </td>
                <td style="width: 10px">
                </td>
                <td align="center">
                    <input type="button" value="@PMI.CETools.Recursos.AppResources.Vistas.Cancelar" class="boton" id="btnCancelar" />
                </td>
            </tr>
        </table>

    </fieldset>
}
